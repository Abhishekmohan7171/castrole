<div class="min-h-screen bg-transparent">
  <!-- Mobile Header -->
  <div
    class="lg:hidden sticky top-0 z-40 bg-neutral-900/95 backdrop-blur-sm border-b border-neutral-800"
  >
    <div class="flex items-center justify-between px-4 py-3">
      <button
        (click)="toggleMobileSidebar()"
        class="p-2 hover:bg-white/5 rounded-lg transition-colors"
        aria-label="Toggle menu"
      >
        <svg
          class="w-6 h-6 text-neutral-300"
          fill="none"
          stroke="currentColor"
          viewBox="0 0 24 24"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M4 6h16M4 12h16M4 18h16"
          />
        </svg>
      </button>
      <h1 class="text-lg font-semibold text-white">Settings</h1>
      <button
        (click)="navigateBack()"
        class="p-2 hover:bg-white/5 rounded-lg transition-colors"
        aria-label="Close"
      >
        <svg
          class="w-5 h-5 text-neutral-400"
          fill="none"
          stroke="currentColor"
          viewBox="0 0 24 24"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M6 18L18 6M6 6l12 12"
          />
        </svg>
      </button>
    </div>
  </div>

  <div class="flex">
    <!-- Sidebar Navigation -->
    <aside [class]="sidebarClasses()" (click)="onSidebarBackdropClick($event)">
      <div
        class="bg-transparent h-full overflow-y-auto"
        (click)="$event.stopPropagation()"
      >
        <!-- Desktop Header -->
        <div class="hidden lg:block px-6 py-6">
          <h1 class="text-lg font-semibold text-white">settings</h1>
        </div>

        <!-- Navigation Items -->
        <nav class="space-y-2 px-4">
          @for (tab of availableTabs(); track tab) {
          <button
            (click)="onTabChange(tab)"
            class="w-full text-left px-4 py-4 rounded-xl border-l-2 transition-all duration-200"
            [ngClass]="{
              'bg-[#2D1C36] text-white border-[#946BA9]': activeTab() === tab && isActor(),
              'bg-[#515D69]/30 text-white border-[#90ACC8]': activeTab() === tab && !isActor(),
              'text-[#5E5E67] hover:bg-white/5 border-transparent': activeTab() !== tab
            }"
          >
            <div class="flex items-start gap-3">
              <!-- Icon -->
              <div class="mt-0.5">
                <svg
                  class="w-5 h-5 text-white"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                  viewBox="0 0 24 24"
                  [innerHTML]="getTabIcon(tab)"
                ></svg>
              </div>

              <!-- Text -->
              <div class="flex-1 space-y-0.5">
                <h3
                  class="text-base font-medium"
                  [ngClass]="{
                    'text-white': activeTab() === tab,
                    'text-[#5E5E67]': activeTab() !== tab
                  }"
                >
                  {{ getTabLabel(tab) }}
                </h3>
                <p class="text-xs text-[#5E5E67] leading-tight">
                  {{ getTabDescription(tab) }}
                </p>
              </div>
            </div>
          </button>
          }
        </nav>
      </div>
    </aside>

    <!-- Main Content Area -->
    <main class="flex-1 min-h-screen">
      <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-6 lg:py-8">
        <!-- Content Sections -->
        <div class="space-y-6">
          <h2 class="text-2xl font-semibold text-white mb-6">
            {{ getTabLabel(activeTab()) }}
          </h2>

          @switch (activeTab()) { @case ('account') {
          <app-account-section
            [isActor]="isActor()"
            [userData]="userData()"
            [editableUserData]="editableUserData()"
            [editingFields]="editingFields()"
            [toggleEditField]="toggleEditField.bind(this)"
            [canAddAccount]="canAddAccount.bind(this)"
            [getMissingRole]="getMissingRole.bind(this)"
            [addAccount]="addAccount.bind(this)"
            [switchRole]="switchRole.bind(this)"
            (dataChange)="onEditableDataChange($event)"
          />
          } @case ('privacy') {
          <app-privacy-section
            [isActor]="isActor()"
            [isProducer]="isProducer()"
            [ghostMode]="ghostMode()"
            [lastSeenVisible]="lastSeenVisible()"
            [onlineStatusVisible]="onlineStatusVisible()"
            [readReceipts]="readReceipts()"
            [allowChatRequests]="allowChatRequests()"
            [toggleGhostMode]="toggleGhostMode.bind(this)"
            [toggleLastSeenVisible]="toggleLastSeenVisible.bind(this)"
            [toggleOnlineStatusVisible]="toggleOnlineStatusVisible.bind(this)"
            [toggleReadReceipts]="toggleReadReceipts.bind(this)"
            [toggleAllowChatRequests]="toggleAllowChatRequests.bind(this)"
            [viewBlockedUsers]="viewBlockedUsers.bind(this)"
            [viewRecentLogins]="viewRecentLogins.bind(this)"
            [logoutAllDevices]="logoutAllDevices.bind(this)"
            [deleteAccount]="deleteAccount.bind(this)"
          />
          } @case ('subscriptions') {
          <app-subscriptions-section
            [isActor]="isActor()"
            [upgradeToMonthly]="upgradeToMonthlyHandler"
            [upgradeToYearly]="upgradeToYearlyHandler"
            [manageSubscription]="manageSubscription"
            [viewPaymentHistory]="viewPaymentHistory"
          />
          } @case ('analytics') {
          <app-analytics-section
            [isSubscribed]="isSubscribed()"
            [analyticsData]="analyticsData()"
            [upgradeSubscription]="upgradeToYearlyFromAnalyticsHandler"
          />
          } @case ('support') {
          <app-support-section
            [isActor]="isActor()"
            [supportSubject]="supportSubject()"
            [supportConcern]="supportConcern()"
            [isSubmittingSupport]="isSubmittingSupport()"
            [submitSupportForm]="submitSupportForm.bind(this)"
          />
          } @case ('legal') {
          <app-legal-section [isActor]="isActor()" />
          } }
        </div>
      </div>
    </main>
  </div>

  <!-- Blocked Users Modal -->
  @if (showBlockedUsersModal()) {
  <div
    class="fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm"
    (click)="closeBlockedUsersModal()"
  >
    <div
      class="w-full max-w-md rounded-2xl p-6"
      [ngClass]="{
        'bg-purple-950/90 ring-1 ring-purple-900/30 border border-purple-950/30':
          isActor(),
        'bg-black/90 ring-2 ring-white/10 border border-neutral-800': !isActor()
      }"
      (click)="$event.stopPropagation()"
    >
      <!-- Modal Header -->
      <div class="flex items-center justify-between mb-4">
        <div>
          <p
            class="text-xs uppercase tracking-wide"
            [ngClass]="{
              'text-purple-300/80': isActor(),
              'text-neutral-400': !isActor()
            }"
          >
            Privacy & safety
          </p>
          <h3
            class="text-xl font-semibold"
            [ngClass]="{
              'text-purple-100': isActor(),
              'text-neutral-100': !isActor()
            }"
          >
            Blocked users
          </h3>
          <p
            class="text-sm mt-1"
            [ngClass]="{
              'text-purple-200/70': isActor(),
              'text-neutral-300/80': !isActor()
            }"
          >
            Review people you muted from chats, casting calls, or profile views.
            You can unblock them any time.
          </p>
        </div>
        <button
          (click)="closeBlockedUsersModal()"
          class="p-2 rounded-lg transition-colors"
          [ngClass]="{
            'hover:bg-purple-900/20 text-purple-300': isActor(),
            'hover:bg-white/10 text-neutral-300': !isActor()
          }"
          aria-label="Close blocked users dialog"
        >
          <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
            <path
              fill-rule="evenodd"
              d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z"
              clip-rule="evenodd"
            />
          </svg>
        </button>
      </div>

      <div class="space-y-5">
        <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
          <div
            class="rounded-2xl p-4 border"
            [ngClass]="{
              'border-purple-900/40 bg-purple-950/30': isActor(),
              'border-white/10 bg-white/5': !isActor()
            }"
          >
            <p
              class="text-xs uppercase tracking-wide"
              [ngClass]="{
                'text-purple-300/70': isActor(),
                'text-neutral-400': !isActor()
              }"
            >
              total blocked
            </p>
            <p
              class="text-3xl font-semibold mt-1"
              [ngClass]="{ 'text-white': true }"
            >
              {{ blockedUsersList().length }}
            </p>
            <p
              class="text-xs mt-2"
              [ngClass]="{
                'text-purple-200/70': isActor(),
                'text-neutral-400': !isActor()
              }"
            >
              Includes both actor and producer profiles you've muted.
            </p>
          </div>
          <div
            class="rounded-2xl p-4 border"
            [ngClass]="{
              'border-purple-900/40 bg-gradient-to-br from-purple-900/40 to-transparent':
                isActor(),
              'border-white/10 bg-gradient-to-br from-white/5 to-transparent':
                !isActor()
            }"
          >
            <p
              class="text-sm font-medium"
              [ngClass]="{
                'text-purple-100': isActor(),
                'text-neutral-100': !isActor()
              }"
            >
              Why blocks matter
            </p>
            <p
              class="text-xs mt-2 leading-relaxed"
              [ngClass]="{
                'text-purple-200/80': isActor(),
                'text-neutral-300/90': !isActor()
              }"
            >
              Blocked users cannot view your profile, mention you, or send
              casting requests. We keep a private audit trail for trust &
              safety.
            </p>
          </div>
        </div>

        <!-- Blocked Users List -->
        <div class="space-y-4 max-h-[26rem] overflow-y-auto pr-1">
          @if (blockedUsersList().length === 0) {
          <div class="text-center py-10">
            <svg
              class="w-12 h-12 mx-auto mb-3 opacity-60"
              [ngClass]="{
                'text-purple-400': isActor(),
                'text-neutral-400': !isActor()
              }"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M18.364 18.364A9 9 0 005.636 5.636m12.728 12.728L5.636 5.636m12.728 12.728L18.364 5.636M5.636 18.364l12.728-12.728"
              />
            </svg>
            <p
              class="text-sm"
              [ngClass]="{
                'text-purple-200/80': isActor(),
                'text-neutral-300': !isActor()
              }"
            >
              You're all clear—no one is blocked right now.
            </p>
            <p
              class="text-xs mt-1"
              [ngClass]="{
                'text-purple-300/60': isActor(),
                'text-neutral-400': !isActor()
              }"
            >
              You can block someone from their profile or chat at any time.
            </p>
          </div>
          } @else {
          <div
            class="hidden md:grid grid-cols-[1fr,120px,100px] text-[11px] uppercase tracking-wide px-4 text-neutral-400"
            aria-hidden="true"
          >
            <span>User name</span>
            <span class="justify-self-center">Role</span>
            <span class="justify-self-end">Action</span>
          </div>
          @for (blockedUser of blockedUsersList(); track blockedUser.blockedBy)
          {
          <article
            class="rounded-2xl border px-4 py-3"
            [ngClass]="{
              'border-purple-900/30 bg-purple-950/20 hover:border-purple-500/50 transition-colors':
                isActor(),
              'border-white/10 bg-white/5 hover:border-white/30 transition-colors':
                !isActor()
            }"
          >
            <div
              class="flex flex-col gap-3 md:grid md:grid-cols-[1fr,120px,100px] md:items-center"
            >
              <div class="flex items-center gap-3">
                <div
                  class="w-10 h-10 rounded-full flex items-center justify-center text-sm font-semibold"
                  [ngClass]="{
                    'bg-purple-600 text-white': isActor(),
                    'bg-neutral-700 text-white': !isActor()
                  }"
                >
                  {{ getBlockedUserInitial(blockedUser) }}
                </div>
                <div>
                  <p
                    class="text-sm font-semibold"
                    [ngClass]="{
                      'text-purple-100': isActor(),
                      'text-neutral-100': !isActor()
                    }"
                  >
                    {{ getBlockedUserName(blockedUser) }}
                  </p>
                  <p
                    class="text-xs"
                    [ngClass]="{
                      'text-purple-200/70': isActor(),
                      'text-neutral-400': !isActor()
                    }"
                  >
                    {{ blockedUser.reason || "Reason not specified" }} · Blocked
                    {{ formatBlockedDate(blockedUser.blockedAt) }}
                  </p>
                </div>
              </div>

              <span
                class="px-2 py-1 text-[11px] rounded-full font-medium tracking-wide md:justify-self-center"
                [ngClass]="getRoleBadgeClasses(blockedUser.role)"
              >
                {{ formatRoleLabel(blockedUser.role) }}
              </span>

              <button
                (click)="unblockUser(blockedUser)"
                class="text-xs px-3 py-1.5 rounded-lg font-medium md:justify-self-end"
                [ngClass]="{
                  'bg-purple-600 hover:bg-purple-700 text-white': isActor(),
                  'bg-neutral-600 hover:bg-neutral-700 text-white': !isActor()
                }"
              >
                Unblock
              </button>
            </div>
          </article>
          } }
        </div>
      </div>
    </div>
  </div>
  }

  <!-- Recent Logins Modal -->
  @if (showRecentLoginsModal()) {
  <div
    class="fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm"
    (click)="closeRecentLoginsModal()"
  >
    <div
      class="w-full max-w-md rounded-2xl p-6"
      [ngClass]="{
        'bg-purple-950/90 ring-1 ring-purple-900/30 border border-purple-950/30':
          isActor(),
        'bg-black/90 ring-2 ring-white/10 border border-neutral-800': !isActor()
      }"
      (click)="$event.stopPropagation()"
    >
      <!-- Modal Header -->
      <div class="flex items-center justify-between mb-4">
        <div>
          <p
            class="text-xs uppercase tracking-wide"
            [ngClass]="{
              'text-purple-300/80': isActor(),
              'text-neutral-400': !isActor()
            }"
          >
            account activity
          </p>
          <h3
            class="text-xl font-semibold"
            [ngClass]="{
              'text-purple-100': isActor(),
              'text-neutral-100': !isActor()
            }"
          >
            Recent logins
          </h3>
          <p
            class="text-sm mt-1"
            [ngClass]="{
              'text-purple-200/70': isActor(),
              'text-neutral-300/80': !isActor()
            }"
          >
            Track devices that accessed your account. Unknown sessions can be
            revoked instantly.
          </p>
        </div>
        <button
          (click)="closeRecentLoginsModal()"
          class="p-2 rounded-lg transition-colors"
          [ngClass]="{
            'hover:bg-purple-900/20 text-purple-300': isActor(),
            'hover:bg-white/10 text-neutral-300': !isActor()
          }"
          aria-label="Close recent logins dialog"
        >
          <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
            <path
              fill-rule="evenodd"
              d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z"
              clip-rule="evenodd"
            />
          </svg>
        </button>
      </div>

      <div class="space-y-5">
        <div
          class="rounded-2xl border p-4"
          [ngClass]="{
            'border-purple-900/40 bg-purple-950/20': isActor(),
            'border-white/10 bg-white/5': !isActor()
          }"
        >
          <div class="flex flex-wrap gap-4">
            <div>
              <p
                class="text-xs uppercase tracking-wide"
                [ngClass]="{
                  'text-purple-300/70': isActor(),
                  'text-neutral-400': !isActor()
                }"
              >
                Currently active
              </p>
              <p class="text-2xl font-semibold text-white">
                {{ countCurrentSessions() || 1 }}
              </p>
              <p
                class="text-xs mt-1"
                [ngClass]="{
                  'text-purple-200/70': isActor(),
                  'text-neutral-400': !isActor()
                }"
              >
                Sessions signed in right now
              </p>
            </div>
            <div class="flex-1 min-w-[180px]">
              <p
                class="text-xs uppercase tracking-wide"
                [ngClass]="{
                  'text-purple-300/70': isActor(),
                  'text-neutral-400': !isActor()
                }"
              >
                last reviewed
              </p>
              <p class="text-sm font-medium text-white">Just now</p>
              <p
                class="text-xs mt-1"
                [ngClass]="{
                  'text-purple-200/70': isActor(),
                  'text-neutral-400': !isActor()
                }"
              >
                We notify you if a new device signs in from an unusual location.
              </p>
            </div>
            <button
              (click)="logoutAllDevices()"
              class="px-4 py-2 rounded-lg text-sm font-medium"
              [ngClass]="{
                'bg-red-600/80 hover:bg-red-600 text-white transition-colors': true
              }"
            >
              Logout all devices
            </button>
          </div>
        </div>

        <!-- Recent Logins List -->
        <div class="space-y-4 max-h-[26rem] overflow-y-auto pr-1">
          @if (recentLoginsList().length === 0) {
          <div class="text-center py-10">
            <svg
              class="w-12 h-12 mx-auto mb-3 opacity-60"
              [ngClass]="{
                'text-purple-400': isActor(),
                'text-neutral-400': !isActor()
              }"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"
              />
            </svg>
            <p
              class="text-sm"
              [ngClass]="{
                'text-purple-200/80': isActor(),
                'text-neutral-300': !isActor()
              }"
            >
              No login history yet.
            </p>
            <p
              class="text-xs mt-1"
              [ngClass]="{
                'text-purple-300/60': isActor(),
                'text-neutral-400': !isActor()
              }"
            >
              We'll show devices here once you start signing in on multiple
              platforms.
            </p>
          </div>
          } @else { @for (device of recentLoginsList(); track device.id ||
          device.platform + device.model) {
          <article
            class="rounded-2xl border p-4 space-y-3"
            [ngClass]="{
              'border-purple-900/30 bg-purple-950/20 hover:border-purple-500/50 transition-colors':
                isActor(),
              'border-white/10 bg-white/5 hover:border-white/30 transition-colors':
                !isActor()
            }"
          >
            <div class="flex items-start gap-3">
              <div class="text-2xl" aria-hidden="true">
                {{ getDeviceIcon(device.platform) }}
              </div>
              <div class="flex-1">
                <div class="flex items-center gap-2 flex-wrap">
                  <p
                    class="text-sm font-semibold"
                    [ngClass]="{
                      'text-purple-100': isActor(),
                      'text-neutral-100': !isActor()
                    }"
                  >
                    {{ getDeviceDisplayName(device) }}
                  </p>
                  <span
                    class="text-[11px] px-2 py-0.5 rounded-full border"
                    [ngClass]="getRiskBadgeClasses(device.risk)"
                  >
                    {{ formatRiskLabel(device.risk) }}
                  </span>
                  @if (device.current) {
                  <span
                    class="text-[11px] px-2 py-0.5 rounded-full bg-emerald-500/20 text-emerald-300 border border-emerald-500/30"
                  >
                    Current session
                  </span>
                  }
                </div>
                <p
                  class="text-xs mt-1"
                  [ngClass]="{
                    'text-purple-200/70': isActor(),
                    'text-neutral-400': !isActor()
                  }"
                >
                  {{ device.city || "Unknown location" }} •
                  {{ device.lastActive || "Recently" }}
                </p>
              </div>
            </div>

            <div
              class="grid grid-cols-2 gap-4 text-xs"
              [ngClass]="{
                'text-purple-200/80': isActor(),
                'text-neutral-300/90': !isActor()
              }"
            >
              <div>
                <p class="uppercase text-[10px] tracking-wide opacity-70">
                  IP address
                </p>
                <p class="mt-0.5 font-medium">{{ device.ip || "—" }}</p>
              </div>
              <div>
                <p class="uppercase text-[10px] tracking-wide opacity-70">
                  App / Browser
                </p>
                <p class="mt-0.5 font-medium">
                  {{ device.browser || "Castrole" }}
                </p>
              </div>
            </div>

            <div class="flex items-center justify-end gap-2">
              <button
                class="text-xs px-3 py-1.5 rounded-lg border"
                [ngClass]="{
                  'border-purple-900/40 text-purple-200 hover:bg-purple-900/30':
                    isActor(),
                  'border-white/20 text-neutral-200 hover:bg-white/10':
                    !isActor()
                }"
              >
                Mark safe
              </button>
              <button
                class="text-xs px-3 py-1.5 rounded-lg font-medium"
                [ngClass]="{
                  'bg-red-600/80 hover:bg-red-600 text-white': true
                }"
              >
                End session
              </button>
            </div>
          </article>
          } }
        </div>
      </div>
    </div>
  </div>
  }

  <!-- Delete Account Confirmation Modal -->
  @if (showDeleteAccountModal()) {
  <div
    class="fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm"
    (click)="closeDeleteAccountModal()"
  >
    <div
      class="w-full max-w-md rounded-2xl p-6"
      [ngClass]="{
        'bg-purple-950/90 ring-1 ring-purple-900/30 border border-purple-950/30':
          isActor(),
        'bg-black/90 ring-2 ring-white/10 border border-neutral-800': !isActor()
      }"
      (click)="$event.stopPropagation()"
    >
      <!-- Modal Header -->
      <div class="flex items-center justify-between mb-6">
        <h3
          class="text-lg font-semibold"
          [ngClass]="{
            'text-purple-100': isActor(),
            'text-neutral-100': !isActor()
          }"
        >
          Delete Account
        </h3>
        <button
          (click)="closeDeleteAccountModal()"
          class="p-2 rounded-lg transition-colors"
          [ngClass]="{
            'hover:bg-purple-900/20 text-purple-300': isActor(),
            'hover:bg-white/10 text-neutral-300': !isActor()
          }"
        >
          <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
            <path
              fill-rule="evenodd"
              d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z"
              clip-rule="evenodd"
            />
          </svg>
        </button>
      </div>

      <!-- Data Export Section -->
      <div class="mb-6 p-4 rounded-lg border"
        [ngClass]="{
          'bg-blue-600/10 border-blue-600/30': true
        }"
      >
        <div class="flex items-start gap-3 mb-3">
          <svg
            class="w-5 h-5 text-blue-400 mt-0.5 flex-shrink-0"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M9 19l3 3m0 0l3-3m-3 3V10"
            />
          </svg>
          <div class="flex-1">
            <h4 class="font-medium text-blue-300 mb-1.5">Download Your Data</h4>
            <p
              class="text-xs leading-relaxed"
              [ngClass]="{
                'text-purple-300/80': isActor(),
                'text-neutral-300': !isActor()
              }"
            >
              Export all your profile data, images, and chat history before deleting (GDPR compliant).
            </p>
          </div>
        </div>
        <button
          type="button"
          (click)="exportMyData()"
          [disabled]="isExporting()"
          class="w-full px-4 py-2 text-sm rounded-lg transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed"
          [ngClass]="{
            'bg-blue-600 hover:bg-blue-700 text-white': !isExporting(),
            'bg-blue-600/50 text-white/70 cursor-not-allowed': isExporting()
          }"
        >
          @if (isExporting()) {
            <div class="flex items-center justify-center gap-2">
              <svg class="w-4 h-4 animate-spin" fill="none" viewBox="0 0 24 24">
                <circle
                  cx="12"
                  cy="12"
                  r="10"
                  stroke="currentColor"
                  stroke-width="4"
                  class="opacity-25"
                ></circle>
                <path
                  fill="currentColor"
                  class="opacity-75"
                  d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"
                ></path>
              </svg>
              Exporting...
            </div>
          } @else {
            Download My Data
          }
        </button>
      </div>

      <!-- Warning Content -->
      <div class="space-y-4 mb-6">
        <!-- Grace Period Info -->
        <div class="flex items-start gap-3 p-3 rounded-lg bg-blue-600/10 border border-blue-600/30">
          <svg
            class="w-5 h-5 text-blue-400 mt-0.5 flex-shrink-0"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"
            />
          </svg>
          <div>
            <h4 class="font-medium text-blue-300 mb-1.5">30-Day Grace Period</h4>
            <p
              class="text-xs leading-relaxed"
              [ngClass]="{
                'text-purple-300/80': isActor(),
                'text-neutral-300': !isActor()
              }"
            >
              Your account will be scheduled for deletion. You can reactivate it anytime within 30 days by logging in.
            </p>
          </div>
        </div>

        <!-- What Happens Immediately -->
        <div class="flex items-start gap-3">
          <svg
            class="w-6 h-6 text-orange-400 mt-0.5 flex-shrink-0"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L4.082 16.5c-.77.833.192 2.5 1.732 2.5z"
            />
          </svg>
          <div>
            <h4 class="font-medium text-orange-400 mb-2">
              Immediate Effects
            </h4>
            <ul
              class="text-sm space-y-1 ml-4"
              [ngClass]="{
                'text-purple-300/60': isActor(),
                'text-neutral-400': !isActor()
              }"
            >
              <li>• Logged out from all devices</li>
              <li>• Both Actor and Producer profiles hidden from search</li>
              <li>• Cannot login until reactivated</li>
              <li>• Confirmation email sent with reactivation instructions</li>
            </ul>
          </div>
        </div>

        <!-- Permanent Deletion Warning -->
        <div class="flex items-start gap-3 p-3 rounded-lg bg-red-600/10 border border-red-600/30">
          <svg
            class="w-5 h-5 text-red-400 mt-0.5 flex-shrink-0"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L4.082 16.5c-.77.833.192 2.5 1.732 2.5z"
            />
          </svg>
          <div>
            <h4 class="font-medium text-red-400 mb-1.5">After 30 Days</h4>
            <p
              class="text-xs leading-relaxed"
              [ngClass]="{
                'text-purple-300/80': isActor(),
                'text-neutral-300': !isActor()
              }"
            >
              All your data will be <strong>permanently deleted</strong> including profile, media, chat history, and analytics. This cannot be undone.
            </p>
          </div>
        </div>
      </div>

      <!-- Confirmation Input -->
      <div class="space-y-4 mb-6">
        <div>
          <label
            class="block text-sm font-medium mb-2"
            [ngClass]="{
              'text-purple-200/80': isActor(),
              'text-neutral-300': !isActor()
            }"
          >
            Type "{{ getRequiredDeleteText() }}" to confirm:
          </label>
          <input
            type="text"
            [(ngModel)]="deleteConfirmationText"
            placeholder="Type here..."
            class="w-full px-3 py-2 text-sm rounded-lg border transition-all duration-200 focus:ring-2 focus:ring-offset-0"
            [ngClass]="{
              'bg-purple-950/20 border-purple-900/30 text-purple-100 placeholder-purple-400/50 focus:border-purple-500 focus:ring-purple-500/20':
                isActor(),
              'bg-black/20 border-neutral-700 text-neutral-200 placeholder-neutral-500 focus:border-neutral-500 focus:ring-neutral-500/20':
                !isActor()
            }"
            [disabled]="isDeleting()"
          />
        </div>
      </div>

      <!-- Action Buttons -->
      <div class="flex gap-3">
        <button
          (click)="closeDeleteAccountModal()"
          class="flex-1 px-4 py-2 text-sm rounded-lg border transition-all duration-200"
          [ngClass]="{
            'border-purple-900/30 text-purple-300 hover:bg-purple-950/20':
              isActor(),
            'border-neutral-700 text-neutral-300 hover:bg-black/20': !isActor()
          }"
          [disabled]="isDeleting()"
        >
          Cancel
        </button>
        <button
          (click)="confirmDeleteAccount()"
          class="flex-1 px-4 py-2 text-sm rounded-lg transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed"
          [ngClass]="{
            'bg-red-600 hover:bg-red-700 text-white':
              canConfirmDelete() && !isDeleting(),
            'bg-red-600/50 text-white/50 cursor-not-allowed':
              !canConfirmDelete() || isDeleting()
          }"
          [disabled]="!canConfirmDelete() || isDeleting()"
        >
          @if (isDeleting()) {
          <div class="flex items-center gap-2">
            <svg class="w-4 h-4 animate-spin" fill="none" viewBox="0 0 24 24">
              <circle
                cx="12"
                cy="12"
                r="10"
                stroke="currentColor"
                stroke-width="4"
                class="opacity-25"
              ></circle>
              <path
                fill="currentColor"
                class="opacity-75"
                d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"
              ></path>
            </svg>
            Deleting...
          </div>
          } @else { Delete Account }
        </button>
      </div>
    </div>
  </div>
  }

  <!-- Add Account Modal -->
  @if (showAddAccountModal()) {
  <app-add-account-modal
    [accountType]="addAccountType()"
    [email]="userData()?.email || ''"
    [phone]="userData()?.phone || ''"
    (close)="closeAddAccountModal()"
    (submit)="handleAddAccountSubmit($event)"
  />
  }
</div>
